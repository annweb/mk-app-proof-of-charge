webpackJsonp([0],{1504:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(2),u=r(i),c=n(49),f=r(c),s=n(5),d=r(s),l=n(9),p=r(l),m=n(7),h=r(m),v=n(8),g=r(v),y=n(0),C=(r(y),n(13)),x=(r(C),n(250)),w=n(570),A=r(w),k=(o=(0,x.wrapper)(A.default))(a=function(e){function t(){return(0,d.default)(this,t),(0,h.default)(this,(t.__proto__||(0,f.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){return this.props.monkeyKing((0,u.default)({},this.props,{path:"root"}))}}]),t}(y.Component))||a;t.default=k,e.exports=t.default},1505:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=new y.action(e),n=R.default.actionCreator((0,i.default)({},e,{metaAction:t})),r=new _((0,i.default)({},e,{metaAction:t,extendAction:n})),o=(0,i.default)({},t,n.gridAction,r);return t.config({metaHandlers:o}),o}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=r(a),u=n(568),c=r(u),f=n(569),s=r(f),d=n(5),l=r(d),p=n(9),m=r(p);t.default=o;var h=n(0),v=r(h),g=n(13),y=(r(g),n(250)),C=n(567),x=r(C),w=n(70),A=n(10),k=(r(A),n(61)),b=r(k),O=n(1507),R=r(O),_=function(){function e(t){var n=this;(0,l.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.extendAction.gridAction.onInit({component:t,injections:r}),n.component=t,n.injections=r,r.reduce("init"),n.load()},this.load=(0,s.default)(c.default.mark(function e(){var t,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,n.webapi.proofOfCharge.init({id:n.component.props.proofOfChargeId});case 3:r=e.sent,n.injections.reduce("load",r);case 5:case"end":return e.stop()}},e,n)})),this.prev=(0,s.default)(c.default.mark(function e(){var t,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.proofOfCharge.prev(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.next=(0,s.default)(c.default.mark(function e(){var t,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.proofOfCharge.next(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.add=function(){n.injections.reduce("setForm")},this.del=(0,s.default)(c.default.mark(function e(){var t,r,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.metaAction.modal("confirm",{title:"删除",content:"确认删除?"});case 3:if(!(r=e.sent)){e.next=10;break}return e.next=7,n.webapi.proofOfCharge.del({id:t});case 7:o=e.sent,n.metaAction.toast("success","删除单据成功"),n.injections.reduce("setForm",o);case 10:case"end":return e.stop()}},e,n)})),this.audit=(0,s.default)(c.default.mark(function e(){var t,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.metaAction.gf("data.form.id")){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.webapi.proofOfCharge.audit({id:t});case 5:r=e.sent,r&&n.injections.reduce("setForm",r);case 7:case"end":return e.stop()}},e,n)})),this.commonMenuClick=function(e){switch(e.key){case"useCommon":throw"请实现使用常用凭证";case"saveCommon":throw"保存为常用凭证"}},this.moreMenuClick=function(e){switch(e.key){case"del":n.del();break;case"print":throw"请实现打印功能"}},this.save=(0,s.default)(c.default.mark(function e(){var t,r,o,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.metaAction.gf("data.form").toJS(),r=n.checkSave(t),!(r.length>0)){e.next=5;break}return n.metaAction.toast("error",v.default.createElement("ul",{style:{textAlign:"left"}},r.map(function(e){return v.default.createElement("li",null,e)}))),e.abrupt("return");case 5:if(!t.id&&0!=t.id){e.next=12;break}return e.next=8,n.webapi.proofOfCharge.update(t);case 8:o=e.sent,o&&(n.metaAction.toast("success","保存单据成功"),n.injections.reduce("setForm",o)),e.next=16;break;case 12:return e.next=14,n.webapi.proofOfCharge.create(t);case 14:a=e.sent,a&&(n.metaAction.toast("success","保存单据成功"),n.injections.reduce("setForm",a));case 16:case"end":return e.stop()}},e,n)})),this.abstractFocus=(0,s.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.abstract.query();case 2:t=e.sent,n.metaAction.sf("data.other.abstracts",(0,w.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.abstractChange=function(e,t,r){return function(t){var o=r.find(function(e){return e.id==t});o?n.metaAction.sf("data.form.details."+e+".abstract",(0,w.fromJS)(o)):n.metaAction.sf("data.form.details."+e+".abstract",t)}},this.captionOfAccountFocus=(0,s.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.captionOfAccount.query();case 2:t=e.sent,n.metaAction.sf("data.other.captionOfAccounts",(0,w.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.sum=function(e,t){return n.sumInternal(e,function(e,n){return e+n[t]})},this.getTotal=function(e){return"合计:"+b.default.number.moneySmalltoBig(n.sum(e,"debit"))},this.metaAction=t.metaAction,this.extendAction=t.extendAction,this.config=x.default.current,this.webapi=this.config.webapi}return(0,m.default)(e,[{key:"checkSave",value:function(e){var t=[];return e.code||t.push("凭证号不能为空!"),e.date||t.push("日期不能为空!"),e.details.forEach(function(e,n){e.abstract||t.push("明细第"+(n+1)+"行，摘要不能为空！"),e.captionOfAccount||t.push("明细第"+(n+1)+"行，科目不能为空！"),e.debit||e.credit||t.push("明细第"+(n+1)+"行，借方金额和贷方金额不能同时为空或者0！")}),t}},{key:"sumInternal",value:function(e,t){return e&&0!=e.length?e.reduce(function(e,n){var r=t(e,n);return isNaN(r)?e:r},0):"0"}}]),e}();e.exports=t.default},1506:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=new s.reducer(e),n=v.default.reducerCreator((0,i.default)({},e,{metaReducer:t})),r=new g((0,i.default)({},e,{metaReducer:t,extendReducer:n}));return(0,i.default)({},t,n.gridReducer,r)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=r(a),u=n(5),c=r(u);t.default=o;var f=n(70),s=n(250),d=n(567),l=r(d),p=n(571),m=n(10),h=(r(m),n(1507)),v=r(h),g=function e(t){var n=this;(0,c.default)(this,e),this.init=function(e,t){return n.metaReducer.init(e,(0,p.getInitState)())},this.load=function(e,t){var r=t.voucher,o=t.abstracts,a=t.captionOfAccounts;return e=r?n.metaReducer.sf(e,"data.form",(0,f.fromJS)(r)):n.metaReducer.sf(e,"data",(0,f.fromJS)((0,p.getInitState)().data)),e=n.metaReducer.sf(e,"data.other.abstracts",(0,f.fromJS)(o)),e=n.metaReducer.sf(e,"data.other.captionOfAccounts",(0,f.fromJS)(a))},this.setForm=function(e,t){return t?n.metaReducer.sf(e,"data.form",(0,f.fromJS)(t)):n.metaReducer.sf(e,"data.form",(0,f.fromJS)((0,p.getInitState)().data.form))},this.metaReducer=t.metaReducer,this.config=l.default.current};e.exports=t.default},1507:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(){return{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"mk-app-proof-of-charge-cell",emptyRow:{},getColNames:function(e){return["abstract","captionOfAccount","debit","credit"]},cellIsReadonly:function(e,t,n){return!1}}}}function a(e){return{gridAction:new s.default.action((0,c.default)({},e,{gridOption:o()}))}}function i(e){return{gridReducer:new s.default.reducer((0,c.default)({},e,{gridOption:o()}))}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),c=r(u),f=n(1508),s=r(f);t.default={actionCreator:a,reducerCreator:i},e.exports=t.default},1508:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1509),a=r(o),i=n(1510),u=r(i);t.default={action:a.default,reducer:u.default},e.exports=t.default},1509:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=r(o),i=n(71),u=r(i),c=n(2),f=r(c),s=n(44),d=r(s),l=n(5),p=r(l),m=n(9),h=r(m),v=n(61),g=r(v),y=n(13),C=r(y),x=function(){function e(t){var n=this;(0,p.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.component=t,n.injections=r},this.isSelectAll=function(e){if(n.option){"string"==typeof e&&e||(e=(0,d.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);return!(!t||0==t.size)&&t.every(function(t){return t.get(n.option[e].selectFieldName)})}},this.selectAll=function(e){return function(t){n.option&&("string"==typeof e&&e||(e=(0,d.default)(n.option)[0]),n.injections.reduce("selectAll",t.target.checked,e))}},this.getSelectedCount=function(e){if(n.option){"string"==typeof e&&e||(e=(0,d.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);if(!t||0==t.size)return 0;return t.filter(function(t){return!!t.get(n.option[e].selectFieldName)}).size}},this.mousedown=function(e){if(n.option){var t=g.default.path.findPathByEvent(e);if(!n.metaAction.isFocus(t))if(-1!=t.indexOf("cell.cell"))n.focusCell(n.getCellInfo(t),t);else{if(!n.metaAction.focusByEvent(e))return;setTimeout(n.cellAutoFocus,16)}}},this.gridKeydown=function(e){if(n.option){var t="";if(37!=e.keyCode&&39!=e.keyCode&&13!=e.keyCode&&108!=e.keyCode&&9!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode||(t=g.default.path.findPathByEvent(e))&&-1!=t.indexOf(",")){if(37==e.keyCode){if(!g.default.dom.cursorAtBegin(e))return;return void n.moveEditCell(t,"left")}if(39==e.keyCode||13==e.keyCode||108==e.keyCode||9==e.keyCode){if(!g.default.dom.cursorAtEnd(e))return;return void n.moveEditCell(t,"right")}return 38==e.keyCode?void n.moveEditCell(t,"up"):40==e.keyCode?void n.moveEditCell(t,"down"):void 0}}},this.cellAutoFocus=function(){g.default.dom.gridCellAutoFocus(n.component,".editable-cell")},this.getCellClassName=function(e,t,r){if(n.option){"string"==typeof r&&r||(r=(0,d.default)(n.option)[0]);var o=n.option[r].cellClassName,a=n.metaAction.isFocus(e)?o+" editable-cell":"";return t&&(a+=" "+o+"-"+t),a}},this.dateOpenChange=function(e){if(!e){var t=C.default.findDOMNode(n.component).querySelector(".editable-cell");if(t&&-1!=t.className.indexOf("datepicker")){t.querySelector("input").focus()}}},this.addRow=function(e){return function(t){n.injections.reduce("addRow",e,t.rowIndex+1)}},this.delRow=function(e){return function(t){n.injections.reduce("delRow",e,t.rowIndex)}},this.metaAction=t.metaAction,t.gridOption&&(this.option=t.gridOption)}return(0,h.default)(e,[{key:"getColNames",value:function(e){return this.option[e].getColNames(this.metaAction.gf)}},{key:"moveEditCell",value:function(e,t){var n=this.getCellInfo(e);this.moveCell(n,t,e)}},{key:"moveCell",value:function(e,t,n){var r=function(e,t,n){return!1},o=(0,d.default)(this.option),a=!0,i=!1,c=void 0;try{for(var s,l=(0,u.default)(o);!(a=(s=l.next()).done);a=!0){var p=s.value;-1!=n.indexOf(p)&&this.option[p].cellIsReadonly&&(r=this.option[p].cellIsReadonly)}}catch(e){i=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw c}}var m=g.default.matrix.move(e.rowCount,e.colCount,{x:e.x,y:e.y},t);m.x===e.x&&m.y===e.y||(r(m,n,this.metaAction.gf)?this.moveCell((0,f.default)({},e,m),t,n):this.focusCell((0,f.default)({},e,m),n))}},{key:"focusCell",value:function(e,t){var n=(0,d.default)(this.option),r=!0,o=!1,i=void 0;try{for(var c,f=(0,u.default)(n);!(r=(c=f.next()).done);r=!0){var s=c.value;if(-1!=t.indexOf(s)){var l,p=this.getColPathPrefix(t,s);this.metaAction.sfs((l={"data.other.focusFieldPath":""+p+this.getColNames(s)[e.x]+".cell.cell,"+e.y},(0,a.default)(l,"data.other."+s+"ScrollToRow",e.y),(0,a.default)(l,"data.other."+s+"ScrollToColumn",e.x+1),l))}}}catch(e){o=!0,i=e}finally{try{!r&&f.return&&f.return()}finally{if(o)throw i}}setTimeout(this.cellAutoFocus,16)}},{key:"getColPathPrefix",value:function(e,t){return e.substring(0,e.indexOf(t))+t+".columns."}},{key:"getCellInfo",value:function(e){if(this.option){var t=g.default.path.parsePath(e),n=(0,d.default)(this.option),r=!0,o=!1,a=void 0;try{for(var i,c=(0,u.default)(n);!(r=(i=c.next()).done);r=!0){var f=i.value;if(-1!=e.indexOf(f)){var s=this.getColPathPrefix(e,f),l=this.metaAction.gf(this.option[f].path).size,p=this.getColNames(f).length,m=t.path.replace(s,"").replace(".cell.cell","").replace(/\s/g,"");return{x:this.getColNames(f).findIndex(function(e){return e==m}),y:Number(t.vars[0]),colCount:p,rowCount:l}}}}catch(e){o=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}}}}]),e}();t.default=x,e.exports=t.default},1510:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(e){return e&&e.__esModule?e:{default:e}}(r),a=n(70),i=function e(t){var n=this;(0,o.default)(this,e),this.selectAll=function(e,t,r){if(!n.option)return e;var o=n.option[r].path,a=n.option[r].selectFieldName,i=n.metaReducer.gf(e,o);if(!i||0==i.size)return e;for(var u=0;u<i.size;u++)e=n.metaReducer.sf(e,o+"."+u+"."+a,t);return e},this.addRow=function(e,t,r){if(!n.option)return e;var o=n.option[t].path,i=n.option[t].emptyRow||{},u=n.metaReducer.gf(e,o);return u=u.insert(r,(0,a.Map)(i)),n.metaReducer.sf(e,o,u)},this.delRow=function(e,t,r){if(!n.option)return e;var o=n.option[t].path,i=n.metaReducer.gf(e,o);return-1==r?e:(i=i.remove(r),0==i.size&&(i=i.insert(r,(0,a.Map)({}))),n.metaReducer.sf(e,o,i))},this.metaReducer=t.metaReducer,t.gridOption&&(this.option=t.gridOption)};t.default=i,e.exports=t.default}});